package target

import "interfaces"

async Target [
	port testControl : requires TestControl
	port control : requires SUTControl
] {
	component sc : SC
	component act : Activity
	
	bind testControl -> sc.testControl
	bind control -> sc.control
	
	channel [ act.controller ] -o)- [ sc.doActivityController ]
}

@Asynchronous
statechart SC [
	port testControl : requires TestControl
	port control : requires SUTControl
	
	port doActivityController : requires ActivityControllerInterface
] {
	
	region Main {
		initial Initial
		state Wait
		state S1 {
			entry / raise doActivityController.control(true);
			exit / raise doActivityController.control(false);
		}
		state Error
		state FS1
	}
	
	transition from Initial to Wait
	transition from Wait to S1 when testControl.start
	transition from S1 to Error when doActivityController.done
	transition from S1 to FS1 when control.anotherSignal
}

activity DoActivity [
	@ActivityController
	port controller : provides ActivityControllerInterface
] {
	
	initial init
	
	action end {
		raise controller.done;
	}
	
	final fin
	
	succession from init to end
	succession from end to fin
	
}

adapter Activity of component doActivity : DoActivity {	
	when any / run
	
	queue controllerMessages(priority = 1, capacity = 1) {
		controller.any
	}
} 
